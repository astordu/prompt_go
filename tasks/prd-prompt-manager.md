# 本地提示词管理软件 - 产品需求文档 (PRD)

## 1. 概述/介绍

本产品是一个基于Python的本地提示词管理软件，通过全局快捷键实现在任意位置快速调用AI模型处理选中文本的功能。软件核心价值在于提供无缝的文本处理体验，用户可以在任何应用程序中选中文本，通过快捷键触发预定义的提示词模板，并将AI模型的响应实时流式输出到当前位置。

## 2. 目标

- **主要目标：** 创建一个轻量级、易用的本地提示词管理系统
- **效率目标：** 实现从文本选择到AI响应输出的全流程自动化
- **可用性目标：** 支持全局快捷键调用，无需切换应用程序
- **响应性目标：** 实现流式输出，提供实时反馈体验

## 3. 用户故事

- **作为用户，** 我希望在任何应用程序中选中文本后按快捷键，就能快速调用AI模型处理这段文本
- **作为用户，** 我希望能够预定义多个提示词模板，通过不同的快捷键调用不同的处理逻辑
- **作为用户，** 我希望AI的响应能够实时地逐字输出到我当前的光标位置
- **作为用户，** 我希望能够简单地配置模型API密钥和快捷键映射
- **作为用户，** 我希望在出现错误时能够得到清晰的错误提示

## 4. 功能需求

### 4.1 项目结构管理
1. 程序启动时自动在当前项目文件夹下创建 `prompt` 子文件夹
2. 支持在 `prompt` 文件夹内存储多个 `.md` 文件作为提示词模板
3. 自动扫描和加载 `prompt` 文件夹内的所有 `.md` 文件

### 4.2 配置文件管理
4. 创建全局配置文件用于存储所有AI模型的API密钥
5. 创建快捷键映射配置文件，支持1-9个快捷键的自定义配置
6. 支持配置文件的动态重新加载

### 4.3 提示词模板格式
7. 支持 `.md` 文件格式的提示词模板
8. 使用 `---` 作为分隔符区分模型信息和提示词内容
9. 支持 `{{变量名}}` 格式的占位符（每个模板限制一个占位符）
10. 模板第一部分包含模型调用信息，第二部分包含提示词内容

### 4.4 AI模型集成
11. 支持Deepseek API调用
12. 实现模型响应的流式输出处理
13. 支持模型配置管理

### 4.5 全局快捷键系统
15. 监听全局快捷键 `control + option + command + 1-9`
16. 支持快捷键的自定义配置
17. 实现快捷键到模板文件的映射关系
18. 保持程序后台监听状态

### 4.6 文本处理流程
19. 自动获取当前选中的文本内容
20. 将选中文本插入到对应模板的占位符位置
21. 组合完整的提示词并发送给指定的AI模型
22. 将模型响应实时流式输出到当前光标位置（文本末尾）

### 4.7 错误处理
23. 当选中文本为空时，输出 `!!文本为空!!`
24. 当API调用失败时，输出 `!!api不可用!!`
25. 提供基本的错误日志记录

## 5. 非目标（范围外）

- **不包含** GUI用户界面
- **不包含** 模板的可视化管理功能
- **不包含** 模板分类/标签系统
- **不包含** 模板导入/导出功能
- **不包含** 输出历史记录保存
- **不包含** 复杂的多占位符交互填写
- **不包含** 开机自启动功能
- **不包含** 托盘图标或状态指示

## 6. 技术考虑

### 6.1 技术栈
- **核心语言：** Python 3.8+
- **全局快捷键：** pynput 或 keyboard 库
- **剪贴板操作：** pyperclip 库
- **HTTP请求：** requests 或 aiohttp 库
- **配置管理：** configparser 或 YAML

### 6.2 架构建议
- 采用事件驱动的监听器模式
- 分离配置管理、模板解析、模型调用等模块
- 实现异步的API调用和流式输出

### 6.3 文件结构建议
```
prompt_manager/
├── main.py                 # 主程序入口
├── config/
│   ├── global_config.yaml  # 全局配置文件
│   └── hotkey_mapping.yaml # 快捷键映射配置
├── prompt/                 # 提示词模板文件夹
│   ├── template1.md
│   └── template2.md
└── modules/
    ├── config_manager.py   # 配置管理模块
    ├── template_parser.py  # 模板解析模块
    ├── model_client.py     # 模型调用客户端
    └── hotkey_listener.py  # 快捷键监听器
```

## 7. 成功指标

- **功能完整性：** 所有核心功能正常工作，快捷键响应时间 < 500ms
- **稳定性：** 程序可持续运行24小时无崩溃
- **易用性：** 用户可在5分钟内完成基本配置并成功使用
- **错误处理：** 所有预期错误情况都有适当的提示信息

## 8. 开放问题

1. 流式输出的具体实现方式（逐字符 vs 逐词 vs 按块输出）
2. 全局快捷键在不同操作系统上的兼容性测试需求
3. API密钥的安全存储方式（明文 vs 加密）
4. 模板文件的编码格式标准化（UTF-8）
5. 程序异常退出时的恢复机制 